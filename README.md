# USST CAS 自动登录（Tampermonkey 脚本）

一个用于自动登录上海理工大学 CAS 认证页面的 Tampermonkey 用户脚本。脚本会在登录页自动填充学号与密码，并模拟用户输入、点击登录；首次运行会弹出配置窗口，凭据仅保存在本地浏览器的 Tampermonkey 存储中。

## 功能特性

- 首次运行弹窗引导，设置学号、密码与延时；随时可从脚本菜单修改
- 自动定位表单并触发 input/change/keydown/keyup/blur 等事件，尽量贴近人工输入
- 可配置两类延时：脚本启动延迟（startupDelay）与操作间隔（actionDelay）
- 检测验证码：若出现验证码，脚本不会尝试绕过，会等待用户手动输入
- 仅在指定 CAS 登录页自动执行，避免误触其他页面

## 适用环境

- 浏览器：Chrome / Edge / Firefox 等现代浏览器
- 必需扩展：Tampermonkey（油猴）
- 目标站点：`ids6.usst.edu.cn` 和 `course.usst.edu.cn`

## 安装

1. 安装 Tampermonkey

    - 前往 [Tampermonkey 官网](https://www.tampermonkey.net/) 安装适用于你浏览器的扩展

2. 添加脚本

   2.1. 自动安装
       - 通过 [Greasy Fork](https://update.greasyfork.org/scripts/552545/USST%20CAS%20Auto%20Login.user.js)

   2.2. 手动安装
       - 点击浏览器右上角 Tampermonkey 图标 → 创建新脚本…
       - 删除编辑器中默认模板代码
       - 将本仓库 `src/user.js` 的全部内容复制粘贴到编辑器中
       - 保存（Ctrl/Cmd + S）

3. 首次使用

    - 打开需要登录的网页
    - 页面加载后会弹出配置窗口：输入学号、密码，可按需调整延时 → 点击保存
    - 脚本将按配置自动填充并登录

## 使用说明

- 进入登录页后，脚本会自动工作；如未触发，请参考“故障排查”
- 随时可通过 Tampermonkey 菜单项“⚙️ 修改登录配置”更改学号/密码/延时
- 首次运行或配置缺失时会自动弹出配置对话框

## 配置项说明

- 学号（必填）：你的 USST 统一身份认证账号
- 密码（必填）：对应密码
- 启动延迟 startupDelay（毫秒，默认 10）：脚本加载后等待多长时间再开始自动登录
- 操作间隔 actionDelay（毫秒，默认 100）：填写表单各步骤之间的等待时间

注意：延时设置过小可能导致页面脚本来不及响应事件；网络较慢或机器性能较低时，可适当增大。

## 安全与隐私

- 学号与密码仅保存在本地浏览器的 Tampermonkey 存储中（`GM_setValue/GM_getValue`）
- 脚本不会将凭据发送给任何第三方；源码公开可审计
- 建议：
  - 为浏览器配置主密码（或系统级凭据保护）
  - 避免在公共/共享电脑上保存凭据
  - 定期修改密码，并遵守学校安全策略

## 限制与已知问题

- 验证码：脚本不尝试绕过或自动识别验证码。若检测到验证码，会等待用户手动输入。
- 页面变更：若学校登录页结构或选择器更新，可能导致自动填充失败；可提 Issue 或自行调整 `src/user.js` 中的选择器。
- 延时相关：过短的延时可能使事件未完全触发；网络慢/机器卡顿时，适度提高 `startupDelay` 与 `actionDelay`。

## 故障排查（FAQ）

Q: 到了登录页脚本没生效？

- 检查当前 URL 是否为 `https://ids6.usst.edu.cn/authserver/login`
- 打开浏览器控制台（F12 → Console），查看是否有以 `[USST Auto Login]` 开头的日志
- 适当增大 `startupDelay` 或 `actionDelay`
- 确认页面上的用户名/密码/按钮元素 ID 未变化（见“权限与元信息”的选择器）

Q: 如何修改或清除配置？

- 点击 Tampermonkey 图标 → 脚本菜单 → “⚙️ 修改登录配置”
- 或在 Tampermonkey 管理面板中禁用/删除本脚本（会同时清除其本地存储）

Q: 是否支持多账号？

- 当前版本未内置多账号切换；可通过修改配置在不同账号间切换。

Q: 能自动过验证码吗？

- 不支持。若出现验证码，请手动完成后再继续。

## 开发与贡献

- 本地修改：编辑 `src/user.js`，再将变更同步到 Tampermonkey 的脚本编辑器中保存
- 欢迎提交 Issue / PR 来改进选择器、交互或兼容性

## 许可证

- MIT License
- 作者：Zhuocheng Lang
- 图标：来自 USST 官方站点 favicon（仅作展示）

## 免责声明

本脚本仅用于学习与效率提升，请遵守学校与网站的使用政策。使用本脚本造成的任何后果由使用者自行承担。
